<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fangky AI</title>
    <link rel="icon" href="death.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
/* Root Variables */
:root {
  --bg-color: #ffffff;
  --text-color: #333333;
  --chat-bg: #f7f7f8;
  --border-color: #e5e5e5;
  --hover-color: #f0f0f0;
  --ai-message-bg: #f7f7f8;
  --user-message-bg: #ffffff;
  --shadow-color: rgba(0, 0, 0, 0.1);
  --typing-color: #10a37f;
  --navbar-height: 60px;
  --input-height: 60px;
}

/* Dark Theme */
[data-theme="dark"] {
  --bg-color: #202123;
  --text-color: #ffffff;
  --chat-bg: #343541;
  --border-color: #4a4b53;
  --hover-color: #2d2d2d;
  --ai-message-bg: #444654;
  --user-message-bg: #343541;
  --shadow-color: rgba(255, 255, 255, 0.1);
}

/* Base Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    Oxygen, Ubuntu, Cantarell, sans-serif;
  background-color: var(--bg-color);
  color: var(--text-color);
  transition: background-color 0.3s ease, color 0.3s ease;
  line-height: 1.5;
  overflow: hidden;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Navbar Styles */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--navbar-height);
  background-color: var(--bg-color);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 1.5rem;
  z-index: 1000;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.navbar-brand {
  font-size: 1.25rem;
  font-weight: bold;
}

.theme-toggle {
  background: none;
  border: none;
  color: var(--text-color);
  cursor: pointer;
  padding: 0.5rem;
  font-size: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Container and Main Content */
.container {
  margin-top: var(--navbar-height);
  height: calc(100vh - var(--navbar-height));
  display: flex;
  overflow: hidden;
  position: relative;
}

/* Main Content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  background-color: var(--chat-bg);
  min-width: 0;
  height: 100%;
  position: relative;
  padding-bottom: var(--input-height);
}

.chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  padding-bottom: 120px;
  scroll-behavior: smooth;
  scrollbar-width: thin;
  scrollbar-color: var(--border-color) transparent;
}

/* Message Styles */
.message {
  display: flex;
  padding: 1rem;
  gap: 1rem;
  border-bottom: 1px solid var(--border-color);
  animation: fadeIn 0.3s ease-in-out;
  position: relative;
  z-index: 2;
}

.message.ai {
  background-color: var(--ai-message-bg);
}

.message.user {
  background-color: var(--user-message-bg);
}

.avatar {
  width: 36px;
  height: 36px;
  border-radius: 0.375rem;
  flex-shrink: 0;
}

.avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 0.375rem;
}

.message-content {
  flex: 1;
  word-wrap: break-word;
  overflow-wrap: break-word;
  font-size: 0.95rem;
  min-width: 0;
}

/* Input Container Styles */
.input-container {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: var(--bg-color);
  border-top: 1px solid var(--border-color);
  padding: 0.75rem;
  z-index: 100;
}

.input-box {
  display: flex;
  gap: 0.5rem;
  background-color: var(--chat-bg);
  border: 1px solid var(--border-color);
  border-radius: 0.75rem;
  padding: 0.75rem;
  margin: 0 auto;
  max-width: 768px;
}

textarea {
  flex: 1;
  border: none;
  background: none;
  resize: none;
  color: var(--text-color);
  font-family: inherit;
  font-size: 1rem;
  min-height: 24px;
  max-height: 120px;
  outline: none !important;
  padding: 0;
  line-height: 1.5;
}

.action-buttons {
  display: flex;
  gap: 0.5rem;
  align-items: flex-end;
}

.action-btn {
  background: none;
  border: none;
  color: var(--text-color);
  cursor: pointer;
  padding: 0.5rem;
  font-size: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Real-time Status */
.real-time-status {
  position: fixed;
  bottom: calc(var(--input-height) + 20px);
  left: 50%;
  transform: translateX(-50%);
  background-color: var(--bg-color);
  padding: 0.5rem 1rem;
  border-radius: 1rem;
  box-shadow: 0 2px 8px var(--shadow-color);
  font-size: 0.875rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  z-index: 100;
  opacity: 0;
  transition: opacity 0.3s;
}

.real-time-status.active {
  opacity: 1;
}

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background-color: #10a37f;
}

.status-indicator.offline {
  background-color: #dc2626;
}

/* Responsive Design */
@media (max-width: 768px) {
  :root {
    --navbar-height: 56px;
    --input-height: 50px;
  }

  .navbar {
    padding: 0 1rem;
  }

  .navbar-brand {
    font-size: 1.1rem;
  }

  .chat-container {
    padding: 0.75rem;
    padding-bottom: 100px;
  }

  .input-container {
    padding: 0.5rem;
  }

  .input-box {
    margin: 0;
  }

  textarea {
    font-size: 16px;
  }

  .message {
    padding: 0.75rem;
  }

  .message-content {
    font-size: 0.9rem;
  }

  .avatar {
    width: 32px;
    height: 32px;
  }
}
    </style>
  </head>
  <body>
    <nav class="navbar">
        <div class="navbar-brand">Fâš”NGKY AI</div>
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
          <i class="fas fa-moon"></i>
        </button>
    </nav>

    <div class="container">
      <div class="main-content">
        <div class="chat-container" id="chatContainer"></div>

        <div class="real-time-status">
          <div class="status-indicator"></div>
          <span class="status-text">Connected</span>
        </div>

        <div class="input-container">
          <div class="input-box">
            <textarea
              placeholder="Type your message..."
              rows="1"
              oninput="autoResize(this)"
            ></textarea>
            <div class="action-buttons">
              <button
                class="action-btn"
                onclick="attachFile()"
                title="Attach file"
              >
                <i class="fas fa-paperclip"></i>
              </button>
              <button
                class="action-btn"
                onclick="sendMessage()"
                title="Send message"
              >
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
// API Key and Configuration
const PRIVATE_API_KEY = "AIzaSyBJE6IqXU1oDBBhnvNbnrpHZIvwfrS08Ms";

// Configuration and state
let config = {
  aiAvatar: "death.png",
  userAvatar: "users.png",
  theme: localStorage.getItem("theme") || "light",
};

// Rest of the code remains exactly the same
let isConnected = true;
let typingTimeout;
let isTyping = false;

// Load theme on page load
document.addEventListener("DOMContentLoaded", function() {
  applyTheme();
  addWelcomeMessage();
  setupEventListeners();
});

// Theme handling
function toggleTheme() {
  config.theme = config.theme === "light" ? "dark" : "light";
  localStorage.setItem("theme", config.theme);
  applyTheme();
}

function applyTheme() {
  document.documentElement.setAttribute("data-theme", config.theme);
  const themeIcon = document.querySelector(".theme-toggle i");
  if (themeIcon) {
    themeIcon.className = config.theme === "light" ? "fas fa-moon" : "fas fa-sun";
  }
}

// Connection status
function updateConnectionStatus(connected) {
  isConnected = connected;
  const status = document.querySelector(".real-time-status");
  const indicator = status.querySelector(".status-indicator");
  const text = status.querySelector(".status-text");

  status.classList.add("active");
  if (connected) {
    indicator.classList.remove("offline");
    text.textContent = "Connected";
  } else {
    indicator.classList.add("offline");
    text.textContent = "Disconnected";
  }

  setTimeout(() => {
    status.classList.remove("active");
  }, 3000);
}

// Textarea handling
function autoResize(textarea) {
  textarea.style.height = "auto";
  const maxHeight = window.innerHeight < 600 ? 80 : 120;
  textarea.style.height = Math.min(textarea.scrollHeight, maxHeight) + "px";
  textarea.style.overflowY = textarea.scrollHeight > maxHeight ? "auto" : "hidden";
}

// File handling
function attachFile() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*,.pdf,.doc,.docx";
  input.onchange = (e) => handleFileUpload(e.target.files[0]);
  input.click();
}

function handleFileUpload(file) {
  if (!file) return;
  
  const maxSize = 5 * 1024 * 1024; // 5MB
  if (file.size > maxSize) {
    addMessage("File size exceeds 5MB limit. Please choose a smaller file.", "ai");
    return;
  }

  const reader = new FileReader();
  reader.onload = () => addMessage(`Attached file: ${file.name}`, "user");
  reader.onerror = () => addMessage("Error reading file. Please try again.", "ai");
  reader.readAsDataURL(file);
}

// Chat functionality
function addMessage(content, type) {
  const chatContainer = document.getElementById("chatContainer");
  const messageDiv = document.createElement("div");
  messageDiv.className = `message ${type}`;

  const avatarDiv = document.createElement("div");
  avatarDiv.className = "avatar";
  
  const avatarImg = document.createElement("img");
  avatarImg.src = type === "ai" ? config.aiAvatar : config.userAvatar;
  avatarImg.alt = `${type === "ai" ? "AI" : "User"} Avatar`;
  avatarDiv.appendChild(avatarImg);

  const contentDiv = document.createElement("div");
  contentDiv.className = "message-content";
  contentDiv.textContent = content;

  messageDiv.appendChild(avatarDiv);
  messageDiv.appendChild(contentDiv);
  chatContainer.appendChild(messageDiv);

  chatContainer.scrollTop = chatContainer.scrollHeight;
}

function addTypingIndicator() {
  const typingDiv = document.createElement("div");
  typingDiv.className = "message ai typing-indicator";
  typingDiv.innerHTML = `
    <div class="avatar">
      <img src="${config.aiAvatar}" alt="AI Avatar" />
    </div>
    <div class="message-content">
      <div class="typing-dots">
        <span>.</span><span>.</span><span>.</span>
      </div>
    </div>
  `;
  document.getElementById("chatContainer").appendChild(typingDiv);
  return typingDiv;
}

function removeTypingIndicator() {
  const typingIndicator = document.querySelector(".typing-indicator");
  if (typingIndicator) {
    typingIndicator.remove();
  }
}

async function sendMessage() {
  const textarea = document.querySelector("textarea");
  const message = textarea.value.trim();

  if (!message || !isConnected) return;

  textarea.value = "";
  textarea.style.height = "auto";
  autoResize(textarea);

  addMessage(message, "user");
  const typingIndicator = addTypingIndicator();

  try {
    const response = await getGeminiResponse(message);
    removeTypingIndicator();
    addMessage(response, "ai");
  } catch (error) {
    console.error("Error:", error);
    removeTypingIndicator();
    addMessage("Sorry, I encountered an error. Please try again.", "ai");
    updateConnectionStatus(false);
  }
}

async function getGeminiResponse(message) {
  const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";
  
  try {
    const response = await fetch(`${apiUrl}?key=${PRIVATE_API_KEY}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        contents: [
          {
            parts: [
              {
                text: message,
              },
            ],
          },
        ],
      }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return data.candidates[0].content.parts[0].text;
  } catch (error) {
    console.error("Error calling Gemini API:", error);
    throw error;
  }
}

// Setup and initialization
function setupEventListeners() {
  const textarea = document.querySelector("textarea");
  
  // Enter key handling
  textarea.addEventListener("keydown", function(e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // Input handling
  textarea.addEventListener("input", function() {
    autoResize(this);
    if (!isTyping) {
      isTyping = true;
    }
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
      isTyping = false;
    }, 1000);
  });

  // Network status
  window.addEventListener("online", () => updateConnectionStatus(true));
  window.addEventListener("offline", () => updateConnectionStatus(false));
}

function addWelcomeMessage() {
  setTimeout(() => {
    addMessage("Hello! How can I help you today?", "ai");
  }, 1000);
}
      </script>
  </body>
</html>
