<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fangels Chat</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
      }

      :root {
        --primary-color: #4a9eda;
        --primary-hover: #3884bd;
        --bg-color: #f0f2f5;
        --white-tone: #fafafa;
        --sidebar-width: 280px;
        --header-height: 64px;
        --border-color: #e0e3e9;
        --text-primary: #1a1a1a;
        --text-secondary: #666;
        --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      body {
        background: var(--bg-color);
        height: 100vh;
        overflow: hidden;
        color: var(--text-primary);
      }

      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        width: var(--sidebar-width);
        background: var(--white-tone);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
      }

      .sidebar-header {
        padding: 20px;
        height: var(--header-height);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: white;
      }

      .logo {
        font-size: 26px;
        font-weight: bold;
        color: var(--primary-color);
        letter-spacing: -0.5px;
      }

      .new-chat-btn {
        margin: 16px;
        padding: 12px 16px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .new-chat-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
      }

      .chat-list {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
      }

      .chat-item {
        padding: 12px 16px;
        margin-bottom: 8px;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: white;
        border: 1px solid var(--border-color);
      }

      .chat-item:hover {
        background: #f5f7fa;
        transform: translateX(2px);
      }

      .chat-item .title {
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .delete-chat {
        opacity: 0;
        transition: var(--transition);
        padding: 4px;
        border-radius: 4px;
        color: #ff4d4d;
        cursor: pointer;
      }

      .chat-item:hover .delete-chat {
        opacity: 1;
      }

      .delete-chat:hover {
        background: rgba(255, 77, 77, 0.1);
      }

      .main-content {
        margin-left: var(--sidebar-width);
        height: 100vh;
        display: flex;
        flex-direction: column;
        background: var(--white-tone);
      }

      .chat-header {
        height: var(--header-height);
        padding: 0 24px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: white;
        box-shadow: var(--shadow-sm);
      }

      .menu-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        padding: 8px;
        color: var(--text-secondary);
      }

      .chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
        scroll-behavior: smooth;
      }

      .message {
        max-width: 850px;
        margin: 24px auto;
        padding: 16px 20px;
        border-radius: 12px;
        background: white;
        box-shadow: var(--shadow-sm);
        animation: messageIn 0.3s ease;
        display: flex;
        gap: 16px;
      }

      .message .avatar {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .message .avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .message .content {
        flex: 1;
        line-height: 1.5;
      }

      .message.user {
        background: #f0f7ff;
        border: 1px solid #e1effe;
        flex-direction: row-reverse;
      }

      .message.user .avatar {
        background: #e1effe;
        color: var(--primary-color);
      }

      .message.assistant {
        background: white;
        border: 1px solid var(--border-color);
      }

      @keyframes messageIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        background: #f0f7ff;
        border: 1px solid #e1effe;
      }

      .message.assistant {
        background: white;
        border: 1px solid var(--border-color);
      }

      .input-container {
        padding: 20px;
        background: white;
        border-top: 1px solid var(--border-color);
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
      }

      .input-box {
        max-width: 850px;
        margin: 0 auto;
        position: relative;
        background: var(--white-tone);
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
      }

      .input-box:focus-within {
        box-shadow: var(--shadow-md);
      }

      textarea {
        width: 100%;
        padding: 16px;
        padding-right: 50px;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        resize: none;
        min-height: 56px;
        max-height: 200px;
        font-size: 14px;
        line-height: 1.5;
        background: var(--white-tone);
        transition: var(--transition);
      }

      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      .send-button {
        position: absolute;
        right: 12px;
        bottom: 12px;
        background: var(--primary-color);
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
      }

      .send-button:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
      }

      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--text-secondary);
        text-align: center;
        padding: 20px;
      }

      .empty-state h2 {
        margin-bottom: 12px;
        color: var(--text-primary);
      }

      .empty-state p {
        max-width: 400px;
        line-height: 1.6;
      }

      /* Loading indicator */
      .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 12px 16px;
        background: white;
        border-radius: 8px;
        width: fit-content;
        margin: 16px auto;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        background: var(--primary-color);
        border-radius: 50%;
        animation: typingAnimation 1.4s infinite;
        opacity: 0.3;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typingAnimation {
        0%,
        100% {
          opacity: 0.3;
          transform: scale(1);
        }
        50% {
          opacity: 1;
          transform: scale(1.2);
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
          z-index: 1000;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .menu-toggle {
          display: block;
        }

        .chat-header {
          padding: 0 16px;
        }

        .input-container {
          padding: 16px;
        }

        .message {
          margin: 16px auto;
          padding: 14px 16px;
        }
      }
      .code-block {
        background: #f6f8fa;
        border-radius: 6px;
        margin: 1em 0;
        overflow: hidden;
      }

      .code-header {
        background: #f1f3f5;
        padding: 0.5em 1em;
        border-bottom: 1px solid #e1e4e8;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .code-language {
        color: #666;
        font-size: 0.9em;
      }

      .copy-button {
        background: #fff;
        border: 1px solid #d1d5da;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 0.8em;
        cursor: pointer;
        transition: all 0.2s;
      }

      .copy-button:hover {
        background: #f1f3f5;
      }

      .message .content pre {
        margin: 0;
        padding: 1em;
        overflow-x: auto;
      }

      .message .content code {
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo,
          Courier, monospace;
      }

      .message .content p {
        margin: 0.5em 0;
      }

      .message .content ul,
      .message .content ol {
        margin: 0.5em 0;
        padding-left: 2em;
      }

      .message .content li {
        margin: 0.25em 0;
      }

      .message .content h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        margin: 1em 0 0.5em 0;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="logo">Fangels</div>
      </div>
      <button class="new-chat-btn">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        New Chat
      </button>
      <div class="chat-list">
        <!-- Chat history items will be added here -->
      </div>
    </div>

    <div class="main-content">
      <div class="chat-header">
        <button class="menu-toggle">☰</button>
        <div class="current-chat">New Chat</div>
      </div>

      <div id="chatContainer" class="chat-container">
        <div class="empty-state">
          <h2>Welcome to Fangels Chat</h2>
          <p>
            Start a new conversation or select a chat from the sidebar to
            continue where you left off.
          </p>
        </div>
      </div>

      <div class="input-container">
        <div class="input-box">
          <textarea placeholder="Type your message here..." rows="1"></textarea>
          <button class="send-button">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <script>
      // API Configuration
      const API_KEY = "AIzaSyBJE6IqXU1oDBBhnvNbnrpHZIvwfrS08Ms";
      const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`;
      const AI_AVATAR_URL = "wings(1).png";

      // Elements
      const menuToggle = document.querySelector(".menu-toggle");
      const sidebar = document.querySelector(".sidebar");
      const textarea = document.querySelector("textarea");
      const sendButton = document.querySelector(".send-button");
      const chatContainer = document.getElementById("chatContainer");
      const newChatBtn = document.querySelector(".new-chat-btn");
      const chatList = document.querySelector(".chat-list");
      const currentChatTitle = document.querySelector(".current-chat");

      let currentChatId = null;
      let chats = {};

      // Menu toggle functionality
      menuToggle.addEventListener("click", () => {
        sidebar.classList.toggle("active");
      });

      // Create typing indicator
      function createTypingIndicator() {
        const indicator = document.createElement("div");
        indicator.className = "typing-indicator";
        indicator.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
    `;
        return indicator;
      }

      // Format code blocks in the message
      function formatCodeBlocks(text) {
        // Replace markdown code blocks with formatted HTML
        text = text.replace(
          /```(\w+)?\n([\s\S]*?)```/g,
          (match, language, code) => {
            return `<div class="code-block">
                    <div class="code-header">
                        ${
                          language
                            ? `<span class="code-language">${language}</span>`
                            : ""
                        }
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                    </div>
                    <pre><code class="${language || ""}">${escapeHtml(
              code.trim()
            )}</code></pre>
                </div>`;
          }
        );

        // Replace inline code
        text = text.replace(/`([^`]+)`/g, "<code>$1</code>");

        return text;
      }

      // Escape HTML special characters
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Copy code function
      function copyCode(button) {
        const codeBlock =
          button.parentElement.nextElementSibling.querySelector("code");
        navigator.clipboard.writeText(codeBlock.textContent);

        // Show feedback
        const originalText = button.textContent;
        button.textContent = "Copied!";
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      }

      // Format message with proper styling
      function formatMessage(text) {
        // Format code blocks first
        text = formatCodeBlocks(text);

        // Format bold text
        text = text.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

        // Format italic text
        text = text.replace(/\*(.*?)\*/g, "<em>$1</em>");

        // Format lists
        text = text.replace(/^\s*[-*+]\s+(.+)/gm, "<li>$1</li>");
        text = text.replace(/(<li>.*<\/li>)/s, "<ul>$1</ul>");

        // Format numbered lists
        text = text.replace(/^\s*\d+\.\s+(.+)/gm, "<li>$1</li>");
        text = text.replace(/(<li>.*<\/li>)/s, "<ol>$1</ol>");

        // Format headers
        text = text.replace(/^#{1,6}\s+(.+)$/gm, (match, content) => {
          const level = match.trim().indexOf(" ");
          return `<h${level}>${content}</h${level}>`;
        });

        // Convert line breaks to paragraphs
        text = text
          .split("\n\n")
          .map((para) => para.trim())
          .filter((para) => para)
          .map((para) => `<p>${para}</p>`)
          .join("");

        return text;
      }

      // Add message to chat
      function addMessage(text, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}`;

        const avatarDiv = document.createElement("div");
        avatarDiv.className = "avatar";

        if (sender === "assistant") {
          const avatarImg = document.createElement("img");
          avatarImg.src = AI_AVATAR_URL;
          avatarImg.alt = "AI Assistant";
          avatarDiv.appendChild(avatarImg);
        } else {
          avatarDiv.innerHTML = `
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        `;
        }

        const contentDiv = document.createElement("div");
        contentDiv.className = "content";
        contentDiv.innerHTML =
          sender === "assistant" ? formatMessage(text) : escapeHtml(text);

        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      // Send message to API
      async function sendMessage() {
        const message = textarea.value.trim();
        if (!message) return;

        try {
          const emptyState = chatContainer.querySelector(".empty-state");
          if (emptyState) emptyState.remove();

          addMessage(message, "user");

          const typingIndicator = createTypingIndicator();
          chatContainer.appendChild(typingIndicator);

          textarea.value = "";
          textarea.style.height = "auto";

          if (!currentChatId) {
            createNewChat();
          }

          if (!chats[currentChatId].messages) {
            chats[currentChatId].messages = [];
          }

          chats[currentChatId].messages.push({
            role: "user",
            content: message,
          });

          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              contents: [
                {
                  parts: [
                    {
                      text: message,
                    },
                  ],
                },
              ],
              generationConfig: {
                temperature: 0.7,
                topK: 40,
                topP: 0.95,
                maxOutputTokens: 1024,
              },
            }),
          });

          typingIndicator.remove();

          if (!response.ok) {
            throw new Error(`API error: ${response.status}`);
          }

          const data = await response.json();

          if (
            !data.candidates ||
            !data.candidates[0] ||
            !data.candidates[0].content
          ) {
            throw new Error("Invalid API response format");
          }

          const assistantResponse = data.candidates[0].content.parts[0].text;

          addMessage(assistantResponse, "assistant");

          chats[currentChatId].messages.push({
            role: "assistant",
            content: assistantResponse,
          });

          // Update chat title if this is the first message
          if (chats[currentChatId].messages.length === 2) {
            const title =
              message.slice(0, 30) + (message.length > 30 ? "..." : "");
            chats[currentChatId].title = title;
            updateChatList();
            currentChatTitle.textContent = title;
          }

          saveChatsToStorage();
        } catch (error) {
          console.error("Error:", error);
          const typingIndicator = document.querySelector(".typing-indicator");
          if (typingIndicator) typingIndicator.remove();

          addMessage(
            "I apologize, but I encountered an error while processing your request. Please try again.",
            "assistant"
          );
        }
      }

      // Create new chat
      function createNewChat() {
        const chatId = "chat_" + Date.now();
        const chatTitle = "New Chat";

        chats[chatId] = {
          id: chatId,
          title: chatTitle,
          messages: [],
        };

        const chatItem = createChatListItem(chatId, chatTitle);
        chatList.insertBefore(chatItem, chatList.firstChild);

        switchToChat(chatId);
        saveChatsToStorage();
        textarea.focus();
      }

      // Create chat list item
      function createChatListItem(chatId, title) {
        const chatItem = document.createElement("div");
        chatItem.className = "chat-item";
        chatItem.setAttribute("data-id", chatId);
        chatItem.innerHTML = `
        <span class="title">${title}</span>
        <span class="delete-chat" onclick="deleteChat('${chatId}', event)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
        </span>
    `;

        chatItem.addEventListener("click", (e) => {
          if (!e.target.closest(".delete-chat")) {
            switchToChat(chatId);
          }
        });

        return chatItem;
      }

      // Switch to chat
      function switchToChat(chatId) {
        document.querySelectorAll(".chat-item").forEach((item) => {
          item.classList.remove("active");
        });

        const selectedChat = document.querySelector(
          `.chat-item[data-id="${chatId}"]`
        );
        if (selectedChat) {
          selectedChat.classList.add("active");
        }

        currentChatId = chatId;
        const chat = chats[chatId];

        currentChatTitle.textContent = chat.title;
        chatContainer.innerHTML = "";

        if (chat.messages && chat.messages.length > 0) {
          chat.messages.forEach((msg) => {
            addMessage(msg.content, msg.role);
          });
        } else {
          chatContainer.innerHTML = `
            <div class="empty-state">
                <h2>Start a New Conversation</h2>
                <p>Type your message below to begin chatting.</p>
            </div>
        `;
        }

        if (window.innerWidth <= 768) {
          sidebar.classList.remove("active");
        }

        textarea.focus();
      }

      // Delete chat
      function deleteChat(chatId, event) {
        event.stopPropagation();

        if (confirm("Are you sure you want to delete this chat?")) {
          delete chats[chatId];
          updateChatList();

          if (currentChatId === chatId) {
            const remainingChats = Object.keys(chats);
            if (remainingChats.length > 0) {
              switchToChat(remainingChats[0]);
            } else {
              createNewChat();
            }
          }

          saveChatsToStorage();
        }
      }

      // Update chat list
      function updateChatList() {
        chatList.innerHTML = "";
        Object.values(chats)
          .sort((a, b) => b.id.localeCompare(a.id))
          .forEach((chat) => {
            const chatItem = createChatListItem(chat.id, chat.title);
            if (chat.id === currentChatId) {
              chatItem.classList.add("active");
            }
            chatList.appendChild(chatItem);
          });
      }

      // Save chats to local storage
      function saveChatsToStorage() {
        localStorage.setItem("fangels_chats", JSON.stringify(chats));
      }

      // Load chats from local storage
      function loadChatsFromStorage() {
        const savedChats = localStorage.getItem("fangels_chats");
        if (savedChats) {
          chats = JSON.parse(savedChats);
          updateChatList();

          const chatIds = Object.keys(chats);
          if (chatIds.length > 0) {
            switchToChat(chatIds[0]);
          }
        }
      }

      // Textarea auto-resize
      textarea.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      });

      // Event listeners
      sendButton.addEventListener("click", sendMessage);

      textarea.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      newChatBtn.addEventListener("click", createNewChat);

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", (e) => {
        if (
          window.innerWidth <= 768 &&
          !sidebar.contains(e.target) &&
          !menuToggle.contains(e.target) &&
          sidebar.classList.contains("active")
        ) {
          sidebar.classList.remove("active");
        }
      });

      // Handle window resize
      window.addEventListener("resize", () => {
        if (window.innerWidth > 768) {
          sidebar.classList.remove("active");
        }
      });

      // Initialize
      window.addEventListener("load", () => {
        loadChatsFromStorage();
        if (Object.keys(chats).length === 0) {
          createNewChat();
        }
        textarea.focus();
      });

      // Add additional styles
      const additionalStyles = `
    @media (max-width: 768px) {
        .sidebar {
            position: fixed;
            z-index: 1000;
            background: white;
            width: 100%;
            max-width: 280px;
        }
        
        .menu-toggle {
            z-index: 1001;
        }
        
        .main-content {
            width: 100%;
        }
    }

    .message .content img {
        max-width: 100%;
        height: auto;
    }
`;

      const styleElement = document.createElement("style");
      styleElement.textContent = additionalStyles;
      document.head.appendChild(styleElement);
    </script>
  </body>
</html>
